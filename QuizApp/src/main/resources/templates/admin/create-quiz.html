<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Create- Quiz</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link th:href="@{/css/custom.css}" rel="stylesheet">
</head>
<body>
<div th:fragment="content">
    <h1>Create New Quiz</h1>
    <form th:action="@{/admin/create-quiz}" th:object="${quiz}" method="post" class="needs-validation" novalidate>
        <div class="mb-3">
            <label for="title" class="form-label">Title</label>
            <input type="text" class="form-control" th:field="*{title}" id="title" required>
            <div class="invalid-feedback" th:if="${#fields.hasErrors('title')}" th:errors="*{title}">Error</div>
        </div>
        <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <textarea class="form-control" th:field="*{description}" id="description" rows="3" required></textarea>
            <div class="invalid-feedback" th:if="${#fields.hasErrors('description')}" th:errors="*{description}">Error</div>
        </div>

        <!-- Dynamic Questions Section -->
        <div id="questions-container">
            <h4>Questions</h4>
            <div th:each="question, iterStat : ${quiz.questions}" th:with="idx=${iterStat.index + 1}" class="question-block mb-4 border p-3">
                <h5>Question <span th:text="${idx}"></span></h5>
                <input type="hidden" th:field="*{questions[__${idx - 1}__].id}">
                <div class="mb-3">
                    <label th:for="'text' + ${idx}" class="form-label">Question Text</label>
                    <textarea class="form-control" th:field="*{questions[__${idx - 1}__].text}" th:id="'text' + ${idx}" rows="2" required></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Options (A, B, C, D)</label>
                    <div class="row">
                        <div class="col-md-6">
                            <input type="text" class="form-control mb-2" th:field="*{questions[__${idx - 1}__].answers[0]}" placeholder="A" required>
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control mb-2" th:field="*{questions[__${idx - 1}__].answers[1]}" placeholder="B" required>
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control mb-2" th:field="*{questions[__${idx - 1}__].answers[2]}" placeholder="C" required>
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control mb-2" th:field="*{questions[__${idx - 1}__].answers[3]}" placeholder="D" required>
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="correctOption" class="form-label">Correct Option</label>
                    <select class="form-select" th:field="*{questions[__${idx - 1}__].correctOption}" id="correctOption" required>
                        <option value="">Select</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                    </select>
                </div>
                <button type="button" class="btn btn-danger btn-sm" onclick="removeQuestion(this)">Remove Question</button>
            </div>
        </div>

        <button type="button" id="add-question" class="btn btn-outline-primary mb-3">Add Question</button>
        <button type="submit" class="btn btn-success">Create Quiz</button>
    </form>

    <script th:inline="javascript">
        /*<![CDATA[*/
        let questionIndex = /*[[${#lists.size(quiz.questions)}]]*/ 0;
        document.getElementById('add-question').addEventListener('click', function() {
            const container = document.getElementById('questions-container');
            const div = document.createElement('div');
            div.className = 'question-block mb-4 border p-3';
            div.innerHTML = `
                <h5>Question ${++questionIndex}</h5>
                <div class="mb-3">
                    <label class="form-label">Question Text</label>
                    <textarea class="form-control" name="questions[${questionIndex - 1}].text" rows="2" required></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Options</label>
                    <div class="row">
                        <div class="col-md-6"><input type="text" class="form-control mb-2" name="questions[${questionIndex - 1}].answers[0]" placeholder="A" required></div>
                        <div class="col-md-6"><input type="text" class="form-control mb-2" name="questions[${questionIndex - 1}].answers[1]" placeholder="B" required></div>
                        <div class="col-md-6"><input type="text" class="form-control mb-2" name="questions[${questionIndex - 1}].answers[2]" placeholder="C" required></div>
                        <div class="col-md-6"><input type="text" class="form-control mb-2" name="questions[${questionIndex - 1}].answers[3]" placeholder="D" required></div>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Correct Option</label>
                    <select class="form-select" name="questions[${questionIndex - 1}].correctOption" required>
                        <option value="">Select</option><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option>
                    </select>
                </div>
                <button type="button" class="btn btn-danger btn-sm" onclick="removeQuestion(this)">Remove</button>
            `;
            container.appendChild(div);
        });

        function removeQuestion(button) {
            button.parentElement.remove();
        }
        /*]]>*/
    </script>
    <div class="mt-3">
        <a th:href="@{/admin/dashboard}" class="btn btn-secondary">Back to Dashboard</a>
    </div>
</div>

</body>
</html>